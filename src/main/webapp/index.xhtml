<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
<h:head>
    <title>Directorio de Autores</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>

    <style>
        body { background-color: #f7f9fb; font-family: 'Segoe UI', Arial, sans-serif; }
        .container { max-width: 100%; margin-top: 40px; }
        .card { box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); border-radius: 10px; }
        .card-header { background-color: #ffffff; color: black; font-weight: bold; font-size: 1.2rem; }
        .btn-primary { background-color: #1d3557; border: none; }
        .btn-primary:hover { background-color: #457b9d; }
    </style>
</h:head>

<h:body>
    <div class="container">
        <div class="border border-dark px-4">
            <h2 class="mb-4 mt-3">Directorio de Autores</h2>

            <label class="fs-4 fw-semibold">Formulario de Autores</label>
            <div class="border border-secondary rounded mt-2 mb-5">

                <h:form id="formAutor" styleClass="px-3">

                    <h:inputHidden value="#{authorBean.author.id}" />

                    <div class="mb-3 mt-3">
                        <h:outputLabel for="nombre" value="Nombre del Autor:" styleClass="form-label"/>
                        <h:inputText id="nombre" value="#{authorBean.author.name}"
                                     styleClass="form-control"
                                     required="true"
                                     requiredMessage="El nombre es obligatorio.">
                            <f:passThroughAttribute name="placeholder" value="Nombre del autor"/>
                        </h:inputText>
                    </div>

                    <div class="mb-3">
                        <h:outputLabel for="fechaNacimiento" value="Fecha de Nacimiento:" styleClass="form-label"/>
                        <h:inputText id="fechaNacimiento" value="#{authorBean.author.birthDate}"
                                     styleClass="form-control"
                                     required="true"
                                     requiredMessage="La fecha es obligatoria.">
                            <f:convertDateTime pattern="yyyy-MM-dd"/>
                            <f:passThroughAttribute name="type" value="date"/>
                        </h:inputText>
                    </div>

                    <div class="mb-3">
                        <h:outputLabel for="telefono" value="Teléfono:" styleClass="form-label"/>
                        <h:inputText id="telefono" value="#{authorBean.author.phone}"
                                     styleClass="form-control"
                                     required="true"
                                     requiredMessage="El teléfono es obligatorio.">
                            <f:validator validatorId="svPhoneValidator" />
                            <f:passThroughAttribute name="placeholder" value="Ej: 7123-4567"/>
                        </h:inputText>
                    </div>

                    <div class="mb-3">
                        <h:outputLabel for="generoForm" value="Género:" styleClass="form-label"/>
                        <h:selectOneMenu id="generoForm" value="#{authorBean.selectedGenreId}"
                                         styleClass="form-select"
                                         required="true"
                                         requiredMessage="Debe seleccionar un género.">
                            <f:selectItem itemLabel="-- Seleccione un Género --" itemValue="#{null}" noSelectionOption="true"/>
                            <f:selectItems value="#{authorBean.genreList}" var="g"
                                           itemValue="#{g.id}" itemLabel="#{g.name}" />
                        </h:selectOneMenu>
                    </div>

                    <div class="text-center">
                        <h:commandButton value="AGREGAR"
                                         action="#{authorBean.saveOrUpdateAuthor()}"
                                         styleClass="btn btn-primary px-2">
                            <f:ajax execute="@form" render=":formDirectorio:tablaAutores :formAutor :messagesArea" />
                        </h:commandButton>
                    </div>

                    <label class="mt-4">Validaciones</label>
                    <div class="mb-3 border border-dark ps-2 pe-2 rounded" style="min-height: 80px;">
                        <h:messages id="messagesArea" layout="table"
                                    styleClass="alert alert-danger"
                                    infoClass="alert alert-info"
                                    warnClass="alert alert-warning"
                                    errorClass="alert alert-danger" />
                    </div>
                </h:form>
            </div>


            <div class="mt-5">

                <h:form id="formDirectorio">

                    <div class="mt-1 d-flex justify-content-between align-items-center mt-5">
                        <label class="fs-4 fw-semibold">Directorio de Autores</label>

                        <div class="mb-3">
                            <h:selectOneMenu id="generoFiltro" value="#{authorBean.filterGenreId}"
                                             styleClass="form-select w-auto">
                                <f:selectItem itemLabel="-- Todos los Géneros --" itemValue="0"/>
                                <f:selectItems value="#{authorBean.genreList}" var="g"
                                               itemValue="#{g.id}" itemLabel="#{g.name}" />

                                <f:ajax event="change"
                                        listener="#{authorBean.filterAuthorsByGenre}"
                                        render="tablaAutores panelConteo" />
                            </h:selectOneMenu>
                        </div>
                    </div>

                    <div class="mt-1 mb-4">
                        <h:dataTable id="tablaAutores" value="#{authorBean.authorList}" var="auth"
                                     styleClass="table table-bordered table-hover align-middle">

                            <h:column>
                                <f:facet name="header">ID Autor</f:facet>
                                #{auth.id}
                            </h:column>
                            <h:column>
                                <f:facet name="header">Nombre del Autor</f:facet>
                                #{auth.name}
                            </h:column>
                            <h:column>
                                <f:facet name="header">Teléfono</f:facet>
                                #{auth.phone}
                            </h:column>
                            <h:column>
                                <f:facet name="header">Fecha de Nacimiento</f:facet>
                                <h:outputText value="#{auth.birthDate}">
                                    <f:convertDateTime pattern="dd/MM/yyyy" />
                                </h:outputText>
                            </h:column>
                            <h:column>
                                <f:facet name="header">Género Literario</f:facet>
                                #{auth.literaryGenre.name}
                            </h:column>

                            <h:column>
                                <f:facet name="header">Operaciones</f:facet>

                                <h:commandButton value="EDITAR" action="#{authorBean.prepareEdit(auth)}"
                                                 styleClass="btn btn-outline-dark btn-sm me-2">
                                    <f:ajax render=":formAutor :messagesArea" />
                                </h:commandButton>

                                <h:commandButton value="BORRAR" action="#{authorBean.deleteAuthor(auth)}"
                                                 styleClass="btn btn-outline-dark btn-sm">
                                    <f:ajax render="tablaAutores panelConteo :messagesArea" />
                                </h:commandButton>
                            </h:column>
                        </h:dataTable>

                        <h:panelGroup id="panelConteo" layout="block" styleClass="d-flex justify-content-end align-items:center">
                            <p class="mb-0">
                                Número de autores:
                                <h:outputText id="conteoAutores" value="#{authorBean.authorCount}" />
                            </p>

                            <h:commandButton value="Contar" styleClass="btn btn-primary btn-sm ms-2">
                                <f:ajax listener="#{authorBean.countAuthorsInTable}" render="conteoAutores" />
                            </h:commandButton>
                        </h:panelGroup>

                    </div>
                </h:form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</h:body>
</html>